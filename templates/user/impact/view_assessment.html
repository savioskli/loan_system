{% extends "base.html" %}

{% block title %}View Impact Assessment{% endblock %}

{% block head %}
    {{ super() }}
    <style>
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-pending {
            background-color: #FEF3C7;
            color: #92400E;
        }
        .status-verified {
            background-color: #D1FAE5;
            color: #065F46;
        }
        .status-rejected {
            background-color: #FEE2E2;
            color: #B91C1C;
        }
        .metric-item {
            margin-bottom: 1rem;
        }
        .metric-label {
            font-weight: 500;
        }
        .metric-value {
            margin-top: 0.25rem;
        }
        .evidence-item {
            margin-bottom: 0.5rem;
        }
    </style>
{% endblock %}

{% block content %}
<div class="flex min-h-screen bg-gray-100 dark:bg-gray-900">
    <!-- Sidebar -->
    {% include 'user/post_disbursement_sidebar.html' %}
    
    <div class="flex-1 overflow-x-hidden">
        <div class="p-4 sm:ml-64">
            <div class="mt-14"> 
                <!-- Content Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Impact Assessment Details</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Loan ID: {{ loan_id }}</p>
                    </div>
                    <div>
                        <a href="/user/impact_assessment" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                            </svg>
                            Back to List
                        </a>
                    </div>
                </div>

                <!-- Impact Assessment Summary -->
                <div class="bg-white dark:bg-gray-700 shadow rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white">Assessment Summary</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Submitted by {{ submitter_name }} on {{ loan_impact.submission_date.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                        <div>
                            <span class="status-badge {% if loan_impact.verification_status == 'Pending' %}status-pending{% elif loan_impact.verification_status == 'Verified' %}status-verified{% else %}status-rejected{% endif %}">
                                {{ loan_impact.verification_status }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-600 pt-4">
                        <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
                            <div>
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Impact Category</dt>
                                <dd class="mt-1 text-sm text-gray-900 dark:text-white">{{ category.name }}</dd>
                            </div>
                            {% if loan_impact.verification_date %}
                            <div>
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Verification Date</dt>
                                <dd class="mt-1 text-sm text-gray-900 dark:text-white">{{ loan_impact.verification_date.strftime('%Y-%m-%d %H:%M') }}</dd>
                            </div>
                            {% endif %}
                            {% if loan_impact.verification_notes %}
                            <div class="sm:col-span-2">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Verification Notes</dt>
                                <dd class="mt-1 text-sm text-gray-900 dark:text-white">{{ loan_impact.verification_notes }}</dd>
                            </div>
                            {% endif %}
                        </dl>
                    </div>
                </div>

                <!-- Impact Metrics -->
                <div class="bg-white dark:bg-gray-700 shadow rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Impact Metrics</h3>
                    
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        {% for metric in metrics %}
                        <div class="metric-item">
                            <div class="metric-label text-sm font-medium text-gray-700 dark:text-gray-300">{{ metric.name }}</div>
                            <div class="metric-value text-sm text-gray-900 dark:text-white">
                                {% if metric.id in values %}
                                    {% if metric.data_type == 'boolean' %}
                                        {% if values[metric.id]|lower in ['true', 'yes', '1'] %}
                                            Yes
                                        {% else %}
                                            No
                                        {% endif %}
                                    {% elif metric.data_type == 'number' and metric.unit %}
                                        {{ values[metric.id] }} {{ metric.unit }}
                                    {% else %}
                                        {{ values[metric.id] }}
                                    {% endif %}
                                {% else %}
                                    <span class="text-gray-500 dark:text-gray-400">Not provided</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Supporting Evidence -->
                {% if evidence_files %}
                <div class="bg-white dark:bg-gray-700 shadow rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Supporting Evidence</h3>
                    
                    <ul class="space-y-2">
                        {% for evidence in evidence_files %}
                        <li class="evidence-item flex items-center">
                            <svg class="flex-shrink-0 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd" />
                            </svg>
                            <a href="/uploads/impact_evidence/{{ evidence.file_name }}" target="_blank" class="ml-2 text-sm text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300">{{ evidence.file_name }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="flex justify-end space-x-4">
                    <a href="/user/impact_assessment/{{ loan_id }}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Update Assessment
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
